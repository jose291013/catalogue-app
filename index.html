<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Catalogue des Applications</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        .category-badge { margin-right: 5px; }
    </style>
</head>
<body>
<div class="container my-5">
    <h1 class="mb-4">Catalogue des Applications</h1>
    <select id="languageSelect" class="form-select mb-3" style="max-width: 200px;">
        <option value="fr">Français</option>
        <option value="en">English</option>
        <option value="es">Español</option>
    </select>
    
    <input type="text" id="searchInput" class="form-control mb-3" placeholder="Rechercher une application...">
    
    
    <select id="categorySelect" class="form-select mb-3">
        <option value="all">Toutes les catégories</option>
    </select>
    
    <table class="table table-striped">
        <thead>
        <tr>
            <th>Nom</th>
            <th>Catégorie</th>
            <th>Description</th>
            <th>Lien</th>
        </tr>
        </thead>
        <tbody id="appTableBody"></tbody>
    </table>
    <p id="noDataMessage" class="text-muted">Chargement des données...</p>
</div>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script>
let allData = [];
const csvUrl = 'application.csv'; // Chemin relatif vers ton fichier CSV

document.addEventListener('DOMContentLoaded', function () {
    fetch(csvUrl)
        .then(response => response.text())
        .then(csvText => {
            Papa.parse(csvText, {
                header: true,
                skipEmptyLines: true,
                complete: function (results) {
                    allData = results.data;
                    localStorage.setItem('appData', JSON.stringify(allData));
                    renderTable(allData);
                    generateCategorySelect(allData);
                    document.getElementById('noDataMessage').style.display = 'none';
                }
            });
        })
        .catch(error => {
            console.error('Erreur de chargement CSV :', error);
            document.getElementById('noDataMessage').textContent = 'Impossible de charger les données du serveur.';
        });
});

document.getElementById('searchInput').addEventListener('input', function () {
    const searchTerm = this.value.toLowerCase();
    const filtered = allData.filter(row =>
        row.Nom?.toLowerCase().includes(searchTerm) ||
        row.Catégorie?.toLowerCase().includes(searchTerm) ||
        row.Description?.toLowerCase().includes(searchTerm)
    );
    renderTable(filtered);
});



function renderTable(data) {
    const tbody = document.getElementById('appTableBody');
    tbody.innerHTML = '';
    data.forEach(row => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${row.Nom || ''}</td>
            <td><span class="badge bg-secondary">${row.Catégorie || ''}</span></td>
            <td>${row.Description || ''}</td>
            <td><a href="${row.Lien || '#'}" target="_blank">Lien</a></td>
        `;
        tbody.appendChild(tr);
    });
}

function generateCategorySelect(data) {
    const select = document.getElementById('categorySelect');
    select.innerHTML = '<option value="all">Toutes les catégories</option>';
    const categories = [...new Set(data.map(row => row.Catégorie))].filter(Boolean).sort();
    categories.forEach(cat => {
        select.innerHTML += `<option value="${cat}">${cat}</option>`;
    });

    select.addEventListener('change', function () {
        const selectedCat = this.value;
        const filtered = selectedCat === 'all' ? allData : allData.filter(row => row.Catégorie === selectedCat);
        renderTable(filtered);
    });
}
const translations = {
    fr: {
        title: 'Catalogue des Applications',
        search: 'Rechercher une application...',
        allCategories: 'Toutes les catégories',
        clearData: 'Effacer les données enregistrées',
        name: 'Nom',
        category: 'Catégorie',
        description: 'Description',
        link: 'Lien',
        loading: 'Chargement des données...'
    },
    en: {
        title: 'Application Catalog',
        search: 'Search an application...',
        allCategories: 'All categories',
        clearData: 'Clear saved data',
        name: 'Name',
        category: 'Category',
        description: 'Description',
        link: 'Link',
        loading: 'Loading data...'
    },
    es: {
        title: 'Catálogo de Aplicaciones',
        search: 'Buscar una aplicación...',
        allCategories: 'Todas las categorías',
        clearData: 'Borrar datos guardados',
        name: 'Nombre',
        category: 'Categoría',
        description: 'Descripción',
        link: 'Enlace',
        loading: 'Cargando datos...'
    }
};

const csvFiles = {
    fr: 'application-fr.csv',
    en: 'application-en.csv',
    es: 'application-es.csv'
};

document.getElementById('languageSelect').addEventListener('change', function() {
    const lang = this.value;
    document.querySelector('h1').textContent = translations[lang].title;
    document.getElementById('searchInput').placeholder = translations[lang].search;
    document.querySelector('#categorySelect option[value="all"]').textContent = translations[lang].allCategories;
    document.getElementById('noDataMessage').textContent = translations[lang].loading;
    document.querySelector('th:nth-child(1)').textContent = translations[lang].name;
    document.querySelector('th:nth-child(2)').textContent = translations[lang].category;
    document.querySelector('th:nth-child(3)').textContent = translations[lang].description;
    document.querySelector('th:nth-child(4)').textContent = translations[lang].link;

    // Recharger le CSV correspondant à la langue
    fetch(csvFiles[lang])
        .then(response => response.text())
        .then(csvText => {
            Papa.parse(csvText, {
                header: true,
                skipEmptyLines: true,
                complete: function (results) {
                    allData = results.data;
                    renderTable(allData);
                    generateCategorySelect(allData);
                }
            });
        });
});



</script>
</body>
</html>
