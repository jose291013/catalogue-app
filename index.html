<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Catalogue des Applications</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        .category-badge { margin-right: 5px; }
    </style>
</head>
<body>
<div class="container my-5">
    <h1 class="mb-4">Catalogue des Applications</h1>
    <input type="text" id="searchInput" class="form-control mb-3" placeholder="Rechercher une application...">
    
    <button id="clearData" class="btn btn-danger btn-sm mb-3">Effacer les données enregistrées</button>
    <select id="categorySelect" class="form-select mb-3">
        <option value="all">Toutes les catégories</option>
    </select>
    
    <table class="table table-striped">
        <thead>
        <tr>
            <th>Nom</th>
            <th>Catégorie</th>
            <th>Description</th>
            <th>Lien</th>
        </tr>
        </thead>
        <tbody id="appTableBody"></tbody>
    </table>
    <p id="noDataMessage" class="text-muted">Chargement des données...</p>
</div>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script>
let allData = [];
const csvUrl = 'application.csv'; // Chemin relatif vers ton fichier CSV

document.addEventListener('DOMContentLoaded', function () {
    fetch(csvUrl)
        .then(response => response.text())
        .then(csvText => {
            Papa.parse(csvText, {
                header: true,
                skipEmptyLines: true,
                complete: function (results) {
                    allData = results.data;
                    localStorage.setItem('appData', JSON.stringify(allData));
                    renderTable(allData);
                    generateCategorySelect(allData);
                    document.getElementById('noDataMessage').style.display = 'none';
                }
            });
        })
        .catch(error => {
            console.error('Erreur de chargement CSV :', error);
            document.getElementById('noDataMessage').textContent = 'Impossible de charger les données du serveur.';
        });
});

document.getElementById('searchInput').addEventListener('input', function () {
    const searchTerm = this.value.toLowerCase();
    const filtered = allData.filter(row =>
        row.Nom?.toLowerCase().includes(searchTerm) ||
        row.Catégorie?.toLowerCase().includes(searchTerm) ||
        row.Description?.toLowerCase().includes(searchTerm)
    );
    renderTable(filtered);
});

document.getElementById('clearData').addEventListener('click', function () {
    localStorage.removeItem('appData');
    allData = [];
    renderTable([]);
    generateCategoryButtons([]);
    document.getElementById('noDataMessage').style.display = 'block';
});

function renderTable(data) {
    const tbody = document.getElementById('appTableBody');
    tbody.innerHTML = '';
    data.forEach(row => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${row.Nom || ''}</td>
            <td><span class="badge bg-secondary">${row.Catégorie || ''}</span></td>
            <td>${row.Description || ''}</td>
            <td><a href="${row.Lien || '#'}" target="_blank">Lien</a></td>
        `;
        tbody.appendChild(tr);
    });
}

function generateCategorySelect(data) {
    const select = document.getElementById('categorySelect');
    select.innerHTML = '<option value="all">Toutes les catégories</option>';
    const categories = [...new Set(data.map(row => row.Catégorie))].filter(Boolean).sort();
    categories.forEach(cat => {
        select.innerHTML += `<option value="${cat}">${cat}</option>`;
    });

    select.addEventListener('change', function () {
        const selectedCat = this.value;
        const filtered = selectedCat === 'all' ? allData : allData.filter(row => row.Catégorie === selectedCat);
        renderTable(filtered);
    });
}


</script>
</body>
</html>
